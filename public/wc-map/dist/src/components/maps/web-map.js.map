{"version":3,"file":"web-map.js","sources":["../../../../src/components/maps/web-map.js"],"sourcesContent":["import { LitElement, html, css } from 'lit';\r\nimport { APIkeys } from '../../keys.js';\r\nimport { fetchJson, fetchSource } from '../../utils/fetchdata.js';\r\n\r\nexport class WebMap extends LitElement {\r\n\r\n  static _keys = APIkeys;\r\n\r\n  static get properties() {\r\n    return {\r\n      lat: { type: Number },\r\n      lon: { type: Number },\r\n      zoom: { type: Number },\r\n      pitch: { type: Number },\r\n      bearing: { type: Number },\r\n      mapStyle: { type: String, attribute: 'map-style' },\r\n      mapLayers: { type: String, attribute: 'map-layers'}\r\n    };\r\n  }\r\n\r\n  // inherit below style in derived classes as:\r\n  // static styles = [super.styles, css`...`];\r\n  static styles = css`\r\n    :host {\r\n      position: relative;\r\n      display: block;\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    #map {\r\n      position: absolute;\r\n      width: 100%;\r\n      height: 100%;\r\n    };\r\n  `;\r\n\r\n  constructor() {\r\n    super();\r\n    this._map = null;\r\n    this._maplibrary = null;\r\n    this.mapLoadedPromise = new Promise((resolve, reject) => {\r\n      this.mapLoadedResolve = resolve;\r\n      this.mapLoadedReject = reject;\r\n    });\r\n    this.lat = this.lon = this.zoom = this.pitch = this.bearing = 0;\r\n    this.mapLayers = '';\r\n    this.mapStyle = '';\r\n    this.mapLayersArray = null;\r\n    this.mapStyleObject = null;\r\n    this.resolution = null;\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <style>#map { padding: 4px; }</style>\r\n      <div id=\"map\">\r\n        Please use one of the specific web-map components:\r\n        <ol>\r\n          <li>&lt;web-map-leaflet&gt;</li>\r\n          <li>&lt;web-mapbox-gl&gt;</li>\r\n          <li>&lt;web-maplibre-gl&gt;</li>\r\n          <li>&lt;web-map-openlayers&gt;</li>\r\n        </ol>\r\n      </div>\r\n    `;\r\n  }\r\n  updated(changedProperties) {\r\n    if (!this._map) {\r\n      return;\r\n    }\r\n    console.log('updated', changedProperties.keys());\r\n    if (changedProperties.has('mapLayers') || changedProperties.has('mapStyle')) {\r\n      this._loadLayersAndStyles();      \r\n    }\r\n    if (changedProperties.has('lat') || changedProperties.has('lon') || changedProperties.has('zoom') || changedProperties.has('pitch') || changedProperties.has('bearing')) {\r\n      this._updateView();\r\n    }\r\n    if (changedProperties.has('tool')) {\r\n      \r\n    }\r\n  }\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    // derived classes should set this.map when the map is ready\r\n  }\r\n  getMap() {\r\n    return this.mapLoadedPromise;\r\n  }\r\n  async _loadLayersAndStyles() {\r\n    console.log('loadLayersAndStyles');\r\n    if (!this.fetchingLayersAndStyles) {\r\n      this.fetchingLayersAndStyles = true; \r\n      if ((this.mapLayers && !this.mapLayersArray) || (this.mapStyle && !this.mapStyleObject)) {\r\n        const [mapLayers, mapStyle] = await Promise.all([fetchJson(this.mapLayers), fetchJson(this.mapStyle)]);\r\n        if (mapLayers && !Array.isArray(mapLayers)) {\r\n          mapLayers = [mapLayers];\r\n        }\r\n        this.mapLayersArray = mapLayers;\r\n        this.mapStyleObject = mapStyle;      \r\n        this._updateStyle();\r\n        this._updateLayers();\r\n      } else {\r\n        await this._updateStyle();\r\n        await this._updateLayers();\r\n      }\r\n      this.fetchingLayersAndStyles = false;\r\n    }\r\n  }\r\n  async _updateLayers() {\r\n    console.log('updateLayers');\r\n    if (this._map && this.mapLayersArray) {\r\n      for (const layer of this.mapLayersArray) {\r\n        await fetchSource(layer);\r\n        this._addLayer(layer);\r\n      };\r\n    }\r\n  }\r\n  _updateStyle() {\r\n  }\r\n  _warnNotImplemented(functionName) {\r\n    if (this.constructor.name !== 'WebMap') {\r\n      console.warn(`${functionName} not yet implemented for ${this.constructor.name}`);\r\n    }\r\n  }\r\n  async _updateView() {\r\n    this._warnNotImplemented(`${this.constructor.name}._updateView`);\r\n  }\r\n  async _addLayer(layer) {\r\n    this._warnNotImplemented(`${this.constructor.name}.addLayer`)\r\n  }\r\n  async _mapReady(e) {\r\n    console.log('mapReady');\r\n    await this._updateView();\r\n    await this._loadLayersAndStyles();\r\n    this.dispatchEvent(new CustomEvent('map-ready'));\r\n    this.mapLoadedResolve(this._map, this._maplibrary);\r\n  }\r\n}\r\n\r\ncustomElements.define('web-map', WebMap);"],"names":["LitElement","css","html"],"mappings":"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"}