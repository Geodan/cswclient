{"version":3,"file":"web-maplibre-gl.js","sources":["../../../../src/components/maps/web-maplibre-gl.js"],"sourcesContent":["import { html } from 'lit';\r\n\r\nimport { WebMap } from './web-map.js';\r\nimport { fetchText } from '../../utils/fetchdata.js';\r\nimport '../internal/map-positioner.js';\r\n\r\nexport class WebMapLibreGL extends WebMap {\r\n\r\n  render() {\r\n    return html`\r\n      <style>\r\n        ${WebMapLibreGL.externalStyles}\r\n      </style>\r\n      <div id=\"map\"></div>\r\n      <map-positioner>\r\n        <slot name=\"top-left\" slot=\"top-left\"></slot>\r\n        <slot name=\"top-center\" slot=\"top-center\"></slot>\r\n        <slot name=\"top-right\" slot=\"top-right\"></slot>\r\n        <slot name=\"middle-center\" slot=\"middle-center\"></slot>\r\n        <slot name=\"bottom-left\" slot=\"bottom-left\"></slot>\r\n        <slot name=\"bottom-center\" slot=\"bottom-center\"></slot>\r\n        <slot name=\"bottom-right\" slot=\"bottom-right\"></slot>\r\n      </map-positioner>\r\n    `;\r\n  }\r\n\r\n  static externalStyles = '';\r\n\r\n  async connectedCallback() {\r\n    super.connectedCallback();\r\n    this.status = 'web-maplibre-gl connected to the DOM'\r\n    try {\r\n      // Fetch and apply the external CSS\r\n      if (!WebMapLibreGL.externalStyles) {\r\n        this.status = 'web-maplibre-gl fetching external CSS'        \r\n        // fetch maplibre-gl.css from unpkg.com\r\n        fetchText('https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.css').then((text) => {\r\n          WebMapLibreGL.externalStyles = text;\r\n          this.status = 'web-maplibre-gl external CSS fetched'\r\n          this.requestUpdate();\r\n        });\r\n      }\r\n      // Inject the mapboxgl script\r\n      const script = document.createElement('script');\r\n      script.src = 'https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.js';\r\n      this.status = 'injecting MaplibreGL script'\r\n      script.onload = async () => {\r\n        this.status = 'MaplibreGL script loaded'\r\n        try {\r\n          // Add the map\r\n          const map = new maplibregl.Map({\r\n            container: this.shadowRoot.querySelector('#map'),\r\n            style: {\r\n              version: 8,\r\n              center: [0, 0],\r\n              zoom: 0,\r\n              pitch: 0,\r\n              sources: {},\r\n              layers: []\r\n            }\r\n          });\r\n          \r\n          map.on('load', () => {\r\n            this._map = map; // add the native map to WebMap\r\n            this._maplibrary = maplibregl; // add the native map library to WebMap\r\n            map.on('mousemove', (e) => {\r\n              this.dispatchEvent(new CustomEvent('map-mousemove', \r\n              { \r\n                detail: {\r\n                  originalEvent: e.originalEvent,\r\n                  offsetX: e.point.x,\r\n                  offsetY: e.point.y,\r\n                  lat: e.lngLat.lat,\r\n                  lng: e.lngLat.lng\r\n                }\r\n              }\r\n            ))});\r\n            map.on('click', (e) => {\r\n              this.dispatchEvent(new CustomEvent('map-mouseclick', \r\n              { \r\n                detail: {\r\n                  originalEvent: e.originalEvent,\r\n                  offsetX: e.point.x,\r\n                  offsetY: e.point.y,\r\n                  lat: e.lngLat.lat,\r\n                  lng: e.lngLat.lng\r\n                }\r\n              }\r\n            ))});\r\n            this.updateResolution();\r\n            map.on('zoomend', () => {\r\n              this.updateResolution();\r\n              this.dispatchEvent(new CustomEvent('map-zoomend', { detail: { zoom: map.getZoom() } }));\r\n            });\r\n            this._mapReady()\r\n          });\r\n        } catch (error) {\r\n          throw new Error(error.message);\r\n        }\r\n      };\r\n      document.head.appendChild(script);\r\n    } catch (error) {\r\n      console.error('web-maplibre-gl: ' + error.message)\r\n      this.status = error.message;\r\n      this.MaploadedReject(error.message);\r\n    }\r\n  }\r\n  _addLayer(layer) {\r\n    if (!this._map) {\r\n      console.error('web-maplibre-gl: map not ready for addLayer')\r\n      return;\r\n    }\r\n    if (!layer.source) {\r\n      console.warn(`Layer ${layer.id} has no source`);\r\n      return;\r\n    }\r\n    this._map.addLayer(layer);\r\n  }\r\n  getAngle (latlng1, latlng2) {\r\n    const rad = Math.PI / 180,\r\n        lat1 = latlng1.lat * rad,\r\n        lat2 = latlng2.lat * rad,\r\n        a = Math.sin(lat1) * Math.sin(lat2) +\r\n          Math.cos(lat1) * Math.cos(lat2) * Math.cos((latlng2.lng - latlng1.lng) * rad);\r\n    return Math.acos(Math.min(a, 1)) / rad;\r\n  }\r\n  updateResolution() {\r\n    if (!this._map) {\r\n      return;\r\n    }\r\n    const map = this._map;\r\n    const y = map._container.clientHeight / 2;\r\n    this.resolution = this.getAngle(map.unproject([0, y]), map.unproject([1, y]));\r\n  }\r\n}\r\n\r\ncustomElements.define('web-maplibre-gl', WebMapLibreGL);"],"names":["html"],"mappings":"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"}