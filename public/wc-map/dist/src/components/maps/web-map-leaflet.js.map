{"version":3,"file":"web-map-leaflet.js","sources":["../../../../src/components/maps/web-map-leaflet.js"],"sourcesContent":["import { html, css } from 'lit';\r\nimport { WebMap } from './web-map.js';\r\nimport { fetchText, fetchLayer } from '../../utils/fetchdata.js';\r\nimport '../internal/map-positioner.js';\r\n\r\nexport class WebMapLeaflet extends WebMap {\r\n  \r\n  constructor() {\r\n    super();\r\n    this._map = null;\r\n    this.status = 'web-map-leaflet constructor';\r\n  }\r\n  render() {\r\n    return html`\r\n      <style>\r\n        ${WebMapLeaflet._externalStyles}\r\n      </style>\r\n      <div id=\"map\"></div>\r\n      <map-positioner z-index=\"1100\">\r\n        <slot name=\"top-left\" slot=\"top-left\"></slot>\r\n        <slot name=\"top-center\" slot=\"top-center\"></slot>\r\n        <slot name=\"top-right\" slot=\"top-right\"></slot>\r\n        <slot name=\"middle-center\" slot=\"middle-center\"></slot>\r\n        <slot name=\"bottom-left\" slot=\"bottom-left\"></slot>\r\n        <slot name=\"bottom-center\" slot=\"bottom-center\"></slot>\r\n        <slot name=\"bottom-right\" slot=\"bottom-right\"></slot>\r\n      </map-positioner>\r\n    `;\r\n  }\r\n  static _externalStyles = '';\r\n\r\n  async connectedCallback() {\r\n    super.connectedCallback();\r\n    this.status = 'web-map-leaflet connected to the DOM'\r\n    try {\r\n      // Fetch and apply the external CSS when loaded\r\n      if (!WebMapLeaflet._externalStyles) {\r\n        this.status = 'web-map-leaflet fetching external CSS'\r\n        fetchText('https://unpkg.com/leaflet@1.7.1/dist/leaflet.css').then((text) => {\r\n          WebMapLeaflet._externalStyles = text;\r\n          this.status = 'web-map-leaflet external CSS fetched'\r\n          this.requestUpdate();\r\n        });        \r\n      }\r\n      // Inject the Leaflet script\r\n      const script = document.createElement('script');\r\n      script.src = 'https://unpkg.com/leaflet@1.7.1/dist/leaflet.js';\r\n      this.status = 'injecting Leaflet script'\r\n      script.onload = async () => {\r\n        this.status = 'Leaflet script loaded'\r\n        try {\r\n          // Add the map\r\n          this._map = new window.L.Map(this.shadowRoot.getElementById('map')).setView([52.3522, 5.1], 5);\r\n          console.log('web-map-leaflet map-ready event dispatched')\r\n          this.status = 'web-map-leaflet ready';\r\n          this._mapReady();\r\n        } catch (error) {\r\n          this.status = error.message;\r\n        }\r\n      };\r\n      document.head.appendChild(script);\r\n    } catch (error) {\r\n      console.error('web-map-leaflet: ' + error.message)\r\n      this.status = error.message;\r\n    }\r\n  }\r\n  _nativeAddLayer(layer) {\r\n    if (!this._map) {\r\n      console.error('web-map-leaflet: map not ready for addLayer')\r\n      return;\r\n    }\r\n    // add layer to leaflet map\r\n    // to do: layerFactory\r\n    const options = {};\r\n    if (layer.source.attribution) {\r\n      options.attribution = layer.source.attribution;\r\n    }\r\n    if (layer.source.tileSize) {\r\n      options.tileSize = layer.source.tileSize;\r\n    }\r\n    if (layer.source.zoomOffset) {\r\n      options.zoomOffset = layer.source.zoomOffset;\r\n    }\r\n    if (layer.source.minzoom) {\r\n      options.minZoom = layer.source.minzoom;\r\n    }\r\n    if (layer.source.maxzoom) {\r\n      options.maxNativeZoom = layer.source.maxzoom;\r\n      options.maxZoom = layer.source.maxzoom;\r\n    }\r\n    if (layer.paint) {\r\n      switch (layer.type) {\r\n        case 'line':\r\n          options.style = (_feature) => {\r\n            return {\r\n              stroke: layer.paint['line-color'] !== 'rgba(0, 0, 0, 0)',\r\n              color: layer.paint['line-color'],\r\n              weight: layer.paint['line-width'],\r\n              opacity: layer.paint['line-opacity']\r\n            }\r\n          }\r\n          options.style = {};\r\n          options.style['stroke-color'] = layer.paint['line-color'];\r\n          options.style.weight = layer.paint['line-width'];\r\n          break;\r\n        case 'fill':\r\n          options.style = (_feature) => {\r\n            return {\r\n              stroke: layer.paint['fill-outline-color'] !== layer.paint['fill-color'],\r\n              color: layer.paint['fill-outline-color'] ? layer.paint['fill-outline-color'] : layer.paint['fill-color'],\r\n              weight: layer.paint['fill-outline-color'] ? 1 : 0,\r\n              opacity: layer.paint['fill-opacity'],\r\n              fill: true,\r\n              fillColor: layer.paint['fill-color'],\r\n              fillOpacity: layer.paint['fill-opacity']\r\n            };\r\n          }\r\n          break;\r\n        case 'circle':\r\n          options.pointToLayer = (_feature, latlng) => {\r\n            return window.L.circleMarker(latlng, {\r\n              radius: layer.paint['circle-radius'],\r\n              fillColor: layer.paint['circle-color'],\r\n              color: layer.paint['circle-stroke-color'],\r\n              weight: layer.paint['circle-stroke-width'],\r\n              opacity: layer.paint['circle-opacity'],\r\n              fillOpacity: layer.paint['circle-opacity']\r\n            });\r\n          }\r\n          break;\r\n        default:\r\n          console.error(`web-map-leaflet: unsupported layer type for geojson: ${layer.type}`);\r\n      }\r\n    }\r\n    if (layer.id) {\r\n      options.id = layer.id;\r\n    }\r\n    switch (layer?.source?.type) {\r\n      case 'geojson':\r\n        window.L.geoJSON(layer.source.data, options).addTo(this._map);\r\n        break;\r\n      case 'raster':\r\n        if (layer.source.tiles[0] === 'https://tile.openstreetmap.org/{z}/{x}/{y}.png') {\r\n          window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', options).addTo(this._map);\r\n        } else {\r\n          window.L.tileLayer(layer.source.tiles[0], options).addTo(this._map);\r\n        }\r\n        break;\r\n      default:\r\n        console.error(`web-map-leaflet: unsupported layer type: ${layer.source.type}`);\r\n    }\r\n  }\r\n  _nativeUpdateView() {\r\n    this._map?.setView([this.lat, this.lon], this.zoom);\r\n  }\r\n  _nativeActivateEventListener(event) {\r\n    console.log ('web-map-leaflet: registerNativeEvent for ' + event)\r\n    if (this._map) {\r\n      switch (event) {\r\n        case 'map-mousemove':\r\n          this._map.on('mousemove', (e) => {\r\n            this.dispatchEvent(new CustomEvent('map-mousemove', { detail: {\r\n                originalEvent: e.originalEvent,\r\n                offsetX: e.containerPoint.x,\r\n                offsetY: e.containerPoint.y,\r\n                lat: e.latlng.lat,\r\n                lng: e.latlng.lng\r\n              }}\r\n            ));\r\n          });\r\n          break;\r\n      }\r\n    } else {\r\n      console.error ('web-map-leaflet: map not ready for ' + event)\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define('web-map-leaflet', WebMapLeaflet);"],"names":["html"],"mappings":"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"}