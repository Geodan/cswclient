{"version":3,"file":"maplibregl-tool-boundingbox-handler.js","sources":["../../../src/map-handlers/maplibregl-tool-boundingbox-handler.js"],"sourcesContent":["// maplibregl-handler.js\r\nimport { MapToolBoundingboxInterface  } from '../interfaces/map-tool-boundingbox-interface.js';\r\n\r\nclass MaplibreglToolBoundingboxHandler extends MapToolBoundingboxInterface {\r\n    constructor(mapInstance) {\r\n        super();\r\n        this.webMap = mapInstance;\r\n    }\r\n    createBoundingBox(userOptions = {\r\n      west: null,\r\n      south: null,\r\n      east: null,\r\n      north: null,\r\n      markerColor: '#ffffff',\r\n      markerBorderColor: '#333',\r\n      bboxColor: 'red',\r\n      bboxOpacity: 0.3,\r\n      bboxBorderColor: 'red'\r\n    }) { \r\n      const defaultOptions = {\r\n        west: null,\r\n        south: null,\r\n        east: null,\r\n        north: null,\r\n        markerColor: '#ffffff',\r\n        markerBorderColor: '#333',\r\n        bboxColor: 'rgba(255, 0, 0, 0.3)',\r\n        bboxOpacity: 1,\r\n        bboxBorderColor: 'red'\r\n      };\r\n      // merge default options with user options\r\n      const options = {...userOptions, ...defaultOptions};\r\n      this.webMap.getMap().then((map, _maplibrary) => {\r\n        if (options.west === null || options.south === null || options.east === null || options.north === null) {\r\n          const bounds = map.getBounds();\r\n          let west = bounds.getWest() >= -180 ? bounds.getWest() : -180;\r\n          let south = bounds.getSouth() >= -90 ? bounds.getSouth() : -90;\r\n          let east = bounds.getEast() <= 180 ? bounds.getEast() : 180;\r\n          let north = bounds.getNorth() <= 90 ? bounds.getNorth() : 90;\r\n          north -= (north - south) * 0.02; // 10% smaller bounding box (padding)\r\n          south += (north - south) * 0.02; // 10% smaller bounding box (padding)\r\n          west += (east - west) * 0.02; // 10% smaller bounding box (padding)\r\n          east -= (east - west) * 0.02; // 10% smaller bounding box (padding)\r\n          options.west = options.west === null ? west : options.west;\r\n          options.south = options.south === null ? south : options.south;\r\n          options.east = options.east === null ? east : options.east;\r\n          options.north = options.north === null ? north : options.north;\r\n        }\r\n        this.marker1 = this.addMarker(options.west, options.south, options.markerColor, options.markerBorderColor);\r\n        this.marker2 = this.addMarker(options.east, options.north, options.markerColor, options.markerBorderColor);\r\n        this.bboxLayer = {\r\n          id: 'bbox',\r\n          type: 'fill',\r\n          source: {\r\n            type: 'geojson',\r\n            data: {\r\n              type: 'Feature',\r\n              geometry: {\r\n                type: 'Polygon',\r\n                coordinates: [[\r\n                  [options.west, options.south],\r\n                  [options.east, options.south],\r\n                  [options.east, options.north],\r\n                  [options.west, options.north],\r\n                  [options.west, options.south]\r\n                ]]\r\n              }\r\n            }\r\n          },\r\n          paint: {\r\n            'fill-color': options.bboxColor,\r\n            'fill-opacity': options.bboxOpacity,\r\n            'fill-outline-color': 'red'\r\n          }\r\n        }\r\n        map.addLayer(this.bboxLayer);\r\n        this.updateBoundingBox();\r\n      }) \r\n    }\r\n    addMarker(lng, lat, color = '#ffffff', borderColor = '#333') {\r\n      const el = document.createElement('div');\r\n      el.style.backgroundColor = color; // color of the circle\r\n      el.style.cursor = 'move'; // cursor style\r\n      el.style.border = `2px solid ${borderColor}`; // border of the circle\r\n      el.style.width = '15px'; // width of the circle\r\n      el.style.height = '15px'; // height of the circle\r\n      el.style.borderRadius = '50%'; // make the element a circle\r\n      \r\n      // Create a new marker with the custom element\r\n      const marker = new this.webMap._maplibrary.Marker({\r\n        element: el,\r\n        draggable: true\r\n      })\r\n        .setLngLat([lng, lat]) // replace with your coordinates\r\n        .addTo(this.webMap._map);\r\n      \r\n      // Add event listeners for the dragstart and dragend events\r\n      marker.on('dragstart', () => {\r\n        this.updateBoundingBox();\r\n      });\r\n      marker.on('drag', () => {\r\n        this.updateBoundingBox();\r\n      });\r\n      marker.on('dragend', () => {\r\n        this.updateBoundingBox();\r\n      });\r\n      \r\n      marker.on('dragend', () => {\r\n        var lngLat = marker.getLngLat();\r\n        this.webMap.dispatchEvent(new CustomEvent('map-marker-dragend', { detail: {           \r\n          lat: lngLat.lat,\r\n          lng: lngLat.lng,\r\n         } }));\r\n      });\r\n      return marker;\r\n    }\r\n\r\n    updateBoundingBox() {\r\n      const marker1LngLat = this.marker1.getLngLat();\r\n      const marker2LngLat = this.marker2.getLngLat();\r\n      const west = Math.min(marker1LngLat.lng, marker2LngLat.lng);\r\n      const south = Math.min(marker1LngLat.lat, marker2LngLat.lat);\r\n      const east = Math.max(marker1LngLat.lng, marker2LngLat.lng)\r\n      const north = Math.max(marker2LngLat.lat, marker2LngLat.lat);\r\n      this.webMap.dispatchEvent(new CustomEvent('map-update-boundingbox', { detail: { west, south, east, north } }));\r\n      this.webMap._map.getSource('bbox').setData({\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Polygon',\r\n          coordinates: [[\r\n            [west, south],\r\n            [east, south],\r\n            [east, north],\r\n            [west, north],\r\n            [west, south]\r\n          ]]\r\n        }\r\n      });\r\n    }\r\n\r\n    deleteBoundingBox() {\r\n      if (this.marker1) {\r\n        this.marker1.remove();\r\n      }\r\n      if (this.marker2) {\r\n        this.marker2.remove();\r\n      }\r\n      if (this.bboxLayer) {\r\n        this.webMap._map.removeLayer('bbox');\r\n      }\r\n      if (this.webMap._map.getSource('bbox')) {\r\n        this.webMap._map.removeSource('bbox');\r\n      }\r\n      this.marker1 = this.marker2 = this.bboxLayer = null;\r\n      this.east = this.west = this.north = this.south = null;\r\n    }\r\n\r\n    updateMarker(markerId, lat, lng) {\r\n        // Update logic specific to MaplibreGL\r\n    }\r\n\r\n    finalizeBoundingBox() {\r\n        // Finalize bounding box for MaplibreGL\r\n    }\r\n}\r\n\r\nexport { MaplibreglToolBoundingboxHandler };\r\n"],"names":[],"mappings":"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"}